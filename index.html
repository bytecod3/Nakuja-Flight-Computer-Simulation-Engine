<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Nakuja Flight Computer Testing and Simulation Engine (NaFCTSE): Nakuja Flight Computer Testing and Simulation Engine (NaFCTSE)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="mineva.png"/></td>
  <td id="projectalign">
   <div id="projectname">Nakuja Flight Computer Testing and Simulation Engine (NaFCTSE)<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">A testing and verification tool for the Nakuja Rocket Project flight computers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('index.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Nakuja Flight Computer Testing and Simulation Engine (NaFCTSE) </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro_sec"></a>
Introduction</h1>
<p>Nakuja Flight Computer Testing and Simulation Engine (NaFCTSE) is an internal tool designed for flight computer software and hardware verification using Hardware-in-the-loop (HIL) during rocket development at the Nakuja Project.</p>
<p>Built on the Qt C++ framework and MATLAB, this tool provides a windows desktop app that is the used by the team during the integration and testing (I&amp;T) flight computer development phase, making it easy to catch software and hardware bugs way before launch. The motivation to build was to help the team perform quick and fast bench tests on the flight computers without having to rely on long and spaced drone tests.</p>
<dl class="section note"><dt>Note</dt><dd>This is not a replacement of the actual drone tests that are usually done, rather an enhancement of the testing procedures.</dd></dl>
<h1><a class="anchor" id="step1"></a>
Features and capability</h1>
<p>We built this on the Qt C++ framework which is powerful and versatile for such uses. NaFCSTE comes as a suite of 2 major things:</p><ol type="1">
<li>Test data generation models on MATLAB</li>
<li>Desktop application.</li>
</ol>
<h1><a class="anchor" id="step7"></a>
How it works</h1>
<p>The testing engine is broken into the following systems:</p><ol type="1">
<li>MATLAB Data generation models and scripts</li>
<li>HIL Code embedded into the flight software</li>
<li>Flight computer hardware components</li>
<li>Desktop application</li>
</ol>
<h2><a class="anchor" id="step8"></a>
1. MATLAB Data generation models and scripts</h2>
<dl class="section note"><dt>Note</dt><dd>In development</dd></dl>
<p>The engine shall generate test data used for simulation. This data is generated using a SIMULINK model and MATLAB scripts. It is then packaged into a compact csv(comma separated values) file that is to be consumed by the desktop app. Here is a breakdown of the crucial data that is generated. See <a href="https://github.com/nakujaproject/N4-Flight-Software">https://github.com/nakujaproject/N4-Flight-Software</a> to check the full telemetry data packet in comparison.</p>
<h2><a class="anchor" id="step9"></a>
2. HIL Code embedded into the flight software</h2>
<p>The Hardware-in-the-loop code is responsible for setting the flight software to the right modes to be able to receive the test data. The flight software is in THREE modes: DATA_ACQUISITION_STATE(DAQ), TEST_STATE and FLIGHT_MODE</p>
<p>In the DAQ state, the flight computer receives the test data. To be able to implement this mode, we implemented an improvised version of the XMODEM protocol(<a href="https://wiki.synchro.net/ref:xmodem">https://wiki.synchro.net/ref:xmodem</a>). By setting the flight hardware in the DAQ_STATE, which is basicaly a toggle pin, the flight software sets itself into a handshake state. It sends NACK command to the testing PC after every 4 seconds. In this mode the flight computer will wait until data starts being received through UART.</p>
<p>The user is responsible for initiating the transfer from the PC to the flight computer.</p>
<p>Once the data is received, it is saved into an already initialized SD card as a txt file.</p>
<p>We operate this DAQ mode using a STATE_MACHINE that has 4 states: (I)HANDSHAKE (II)RECEIVE_TEST_DATA (III)CONFIRM_TEST_DATA and (IV)FINISH_DATA_RECEIVE</p>
<ul>
<li>In HANDSHAKE, the flight computer being tested tries to establish communication with the testing PC.</li>
<li>In RECEIVE_TEST_DATA state, the flight computer receives flight data line by line and writes it to SD card.</li>
<li>CONFIRM_TEST_DATA is not used due to redundancy. It is meant to confirm that we received the right and all data by printing out the stored values from the SD card on the Serial debugger.</li>
<li>FINISH_DATA_RECEIVE sets the flight computer to a state that says it is done receiving data. The first time this state is activated, it sends a END_OF_TRANSMISSION signal to the testing PC to confirm end of data transmission.</li>
</ul>
<p>At this point, the user is responsible for resetting the hardware toggle pin to TEST_MODE(see usage for more info)</p>
<p>When the flight computer reboots, it will be in TEST_MODE. It is ready consume the data. Ideally it goes ahead and creates all the tasks and functions required during flight, BUT suspends all functions that read sensors, because the sensors is what we are simulating.</p>
<p>Inside the loop section of the code, we have implemented a CSV parser to help with data consumption. the CSV parser reads the file in the SD card and decodes each row line by line. The csv file is already organized into a telemetry packet structure(see flight software for more info on this).</p>
<p>One task of main importance is the task resposible for checking the flight state. To be able to feed data into this task, we send the decoded data to a queue that the check flight state task the receives and perfoms the checking as per predefined conditions.</p>
<p>In this function, whatever the output of the check state is, we send it to the testing app through UART debug.</p>
<p>When done with data consumption, the software sends a signal to the testing app to indicate that it is done consuming the test data.</p>
<h2><a class="anchor" id="step10"></a>
3. Flight computer hardware components</h2>
<p>The interface provided by the hardware to accommodate the testing system is an SD card and a two pin toggle switch. The SD card stores test data received via serial from the testing PC. This data is later decoded. Also, using the toggle pin, the user can select to put the computer in either the DAQ_MODE, TEST_MODE or FLIGHT_MODE.</p>
<h2><a class="anchor" id="step11"></a>
4. Desktop application</h2>
<dl class="section note"><dt>Note</dt><dd>In development For data visualization of test data in form of graphs, performing handshake with the device under test, and debugging the flight computer.</dd></dl>
<h1><a class="anchor" id="step12"></a>
Installation</h1>
<p>Follow the steps below to install this tool</p>
<h2><a class="anchor" id="step13"></a>
System requirements</h2>
<p>The following are required to install and run this tool:</p>
<h1><a class="anchor" id="step14"></a>
Usage</h1>
<h1><a class="anchor" id="step15"></a>
Adapting NaFCTSE for your flight computer</h1>
<h1><a class="anchor" id="step16"></a>
Contributors</h1>
<ol type="1">
<li>Edwin Mwiti</li>
<li>Naomi Chesang </li>
</ol>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
